<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Alignment | Worked Bioninformatics, Statistics, and Machine Learning Examples</title>
  <meta name="description" content="This is a set of code, notes, lectures, and research that should be helpful for learning purposes." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Alignment | Worked Bioninformatics, Statistics, and Machine Learning Examples" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a set of code, notes, lectures, and research that should be helpful for learning purposes." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Alignment | Worked Bioninformatics, Statistics, and Machine Learning Examples" />
  
  <meta name="twitter:description" content="This is a set of code, notes, lectures, and research that should be helpful for learning purposes." />
  

<meta name="author" content="Stephen Woloszynek" />


<meta name="date" content="2020-02-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dynprog.html"/>
<link rel="next" href="align-alg.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="dynprog.html"><a href="dynprog.html"><i class="fa fa-check"></i><b>2</b> Dynamic Programming</a><ul>
<li class="chapter" data-level="2.1" data-path="dynprog.html"><a href="dynprog.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="dynprog.html"><a href="dynprog.html#rod-cutting"><i class="fa fa-check"></i><b>2.2</b> Rod cutting</a></li>
<li class="chapter" data-level="2.3" data-path="dynprog.html"><a href="dynprog.html#fibonacci-rabbits"><i class="fa fa-check"></i><b>2.3</b> Fibonacci rabbits</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="align.html"><a href="align.html"><i class="fa fa-check"></i><b>3</b> Alignment</a><ul>
<li class="chapter" data-level="3.1" data-path="align.html"><a href="align.html#longest-common-subsequence"><i class="fa fa-check"></i><b>3.1</b> Longest Common Subsequence</a></li>
<li class="chapter" data-level="3.2" data-path="align.html"><a href="align.html#global-alignment"><i class="fa fa-check"></i><b>3.2</b> Global Alignment</a></li>
<li class="chapter" data-level="3.3" data-path="align.html"><a href="align.html#local-alignment"><i class="fa fa-check"></i><b>3.3</b> Local Alignment</a></li>
<li class="chapter" data-level="3.4" data-path="align.html"><a href="align.html#local-alignment-homework"><i class="fa fa-check"></i><b>3.4</b> Local Alignment: Homework</a></li>
<li class="chapter" data-level="3.5" data-path="align.html"><a href="align.html#global-alignment-code-r"><i class="fa fa-check"></i><b>3.5</b> Global Alignment Code (R)</a></li>
<li class="chapter" data-level="3.6" data-path="align.html"><a href="align.html#global-alignment-code-python"><i class="fa fa-check"></i><b>3.6</b> Global Alignment Code (Python)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="align-alg.html"><a href="align-alg.html"><i class="fa fa-check"></i><b>4</b> Alignment Algorithms</a><ul>
<li class="chapter" data-level="4.1" data-path="align-alg.html"><a href="align-alg.html#longest-common-subsequence-1"><i class="fa fa-check"></i><b>4.1</b> Longest Common Subsequence</a></li>
<li class="chapter" data-level="4.2" data-path="align-alg.html"><a href="align-alg.html#global-alignment-r"><i class="fa fa-check"></i><b>4.2</b> Global Alignment (R)</a></li>
<li class="chapter" data-level="4.3" data-path="align-alg.html"><a href="align-alg.html#global-alignment-python"><i class="fa fa-check"></i><b>4.3</b> Global Alignment (Python)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="biocond.html"><a href="biocond.html"><i class="fa fa-check"></i><b>5</b> Bioconductor</a><ul>
<li class="chapter" data-level="5.0.1" data-path="biocond.html"><a href="biocond.html#loading-fasta-files"><i class="fa fa-check"></i><b>5.0.1</b> Loading FASTA Files</a></li>
<li class="chapter" data-level="5.0.2" data-path="biocond.html"><a href="biocond.html#creating-sequence-sets"><i class="fa fa-check"></i><b>5.0.2</b> Creating Sequence Sets</a></li>
<li class="chapter" data-level="5.0.3" data-path="biocond.html"><a href="biocond.html#sample-metadata"><i class="fa fa-check"></i><b>5.0.3</b> Sample Metadata</a></li>
<li class="chapter" data-level="5.1" data-path="biocond.html"><a href="biocond.html#creating-gc-functions"><i class="fa fa-check"></i><b>5.1</b> Creating GC Functions</a></li>
<li class="chapter" data-level="5.2" data-path="biocond.html"><a href="biocond.html#ncbi-esearch"><i class="fa fa-check"></i><b>5.2</b> NCBI ESearch</a></li>
<li class="chapter" data-level="5.3" data-path="biocond.html"><a href="biocond.html#cds"><i class="fa fa-check"></i><b>5.3</b> CDS</a></li>
<li class="chapter" data-level="5.4" data-path="biocond.html"><a href="biocond.html#whole-genomes"><i class="fa fa-check"></i><b>5.4</b> Whole Genomes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sra.html"><a href="sra.html"><i class="fa fa-check"></i><b>6</b> Retrieving Projects</a><ul>
<li class="chapter" data-level="6.0.1" data-path="sra.html"><a href="sra.html#fastq-dump-for-paired-end-reads"><i class="fa fa-check"></i><b>6.0.1</b> Fastq Dump for Paired End Reads</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="phyloseq.html"><a href="phyloseq.html"><i class="fa fa-check"></i><b>7</b> Phyloseq</a></li>
<li class="chapter" data-level="8" data-path="dada.html"><a href="dada.html"><i class="fa fa-check"></i><b>8</b> Dada2</a><ul>
<li class="chapter" data-level="8.1" data-path="dada.html"><a href="dada.html#fastq-prep"><i class="fa fa-check"></i><b>8.1</b> FASTQ Prep</a></li>
<li class="chapter" data-level="8.2" data-path="dada.html"><a href="dada.html#otu-picking"><i class="fa fa-check"></i><b>8.2</b> OTU Picking</a></li>
<li class="chapter" data-level="8.3" data-path="dada.html"><a href="dada.html#running-dada2-on-proteus"><i class="fa fa-check"></i><b>8.3</b> Running Dada2 on Proteus</a><ul>
<li class="chapter" data-level="8.3.1" data-path="dada.html"><a href="dada.html#method-1-using-namegrp-shared-r-library"><i class="fa fa-check"></i><b>8.3.1</b> Method 1: Using nameGrp Shared R Library</a></li>
<li class="chapter" data-level="8.3.2" data-path="dada.html"><a href="dada.html#method-2-creating-a-local-library"><i class="fa fa-check"></i><b>8.3.2</b> Method 2: Creating a Local Library</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="qiime.html"><a href="qiime.html"><i class="fa fa-check"></i><b>9</b> Qiime</a><ul>
<li class="chapter" data-level="9.1" data-path="qiime.html"><a href="qiime.html#otu-picking-1"><i class="fa fa-check"></i><b>9.1</b> OTU Picking</a></li>
<li class="chapter" data-level="9.2" data-path="qiime.html"><a href="qiime.html#summarizing-our-results"><i class="fa fa-check"></i><b>9.2</b> Summarizing Our Results</a></li>
<li class="chapter" data-level="9.3" data-path="qiime.html"><a href="qiime.html#loading-qiime-results-into-phyloseq"><i class="fa fa-check"></i><b>9.3</b> Loading QIIME Results into Phyloseq</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multcomp.html"><a href="multcomp.html"><i class="fa fa-check"></i><b>10</b> Multiple Comparisons</a><ul>
<li class="chapter" data-level="10.1" data-path="multcomp.html"><a href="multcomp.html#hypothesis-testing-and-power"><i class="fa fa-check"></i><b>10.1</b> Hypothesis Testing and Power</a></li>
<li class="chapter" data-level="10.2" data-path="multcomp.html"><a href="multcomp.html#multiple-comparisons"><i class="fa fa-check"></i><b>10.2</b> Multiple Comparisons</a><ul>
<li class="chapter" data-level="10.2.1" data-path="multcomp.html"><a href="multcomp.html#bonferroni"><i class="fa fa-check"></i><b>10.2.1</b> Bonferroni</a></li>
<li class="chapter" data-level="10.2.2" data-path="multcomp.html"><a href="multcomp.html#false-discovery-rate"><i class="fa fa-check"></i><b>10.2.2</b> False Discovery Rate</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Worked Bioninformatics, Statistics, and Machine Learning Examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="align" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Alignment</h1>
<div id="longest-common-subsequence" class="section level2">
<h2><span class="header-section-number">3.1</span> Longest Common Subsequence</h2>
<p>We’re going to tackle alignment programatically in three steps: (1) finding the longest common subsequence, (2) performing a global alignment, and finally (3) performing a local alignment. These steps build upon one another, so the order should seem natural.</p>
<p>A <em>subsequence</em> is simply an ordered set; <strong>it need not be consecutive</strong>. For example, if we had the sequence ABCDEFG, then ABC, ACF, and DFG would all be subsequences, whereas AGD would not. We aim to find the largest subsequence that two nucleotide sequences share. This boils down to essentially an alignment problem only involving insertions and deletions.</p>
<p>The algorithm is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">DEFINE LCS<span class="op">:</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">Given sequences x and y</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="dv">1</span> Create empty an matrix S <span class="cf">for</span> scores and an empty matrix B <span class="cf">for</span> the backtracking path</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="dv">2</span> For i <span class="cf">in</span> <span class="dv">2</span> to length x</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">..<span class="dv">3</span> For j <span class="cf">in</span> <span class="dv">2</span> to length y</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">....<span class="dv">4</span> Obtain the score of the upper S[i,j<span class="dv">-1</span>], upper<span class="op">-</span>left diagonal S[i<span class="dv">-1</span>,j<span class="dv">-1</span>], </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">....  and left S[i<span class="dv">-1</span>,j] cells.</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">...... <span class="cf">if</span> the current nucleotides <span class="cf">in</span> x and y are the same, such that x[i<span class="dv">-1</span>] <span class="op">==</span><span class="st"> </span>y[i<span class="dv">-1</span>], </a>
<a class="sourceLine" id="cb1-11" data-line-number="11">...... set s[i,j] to the maximum score among S[i,j<span class="dv">-1</span>], S[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, and S[i<span class="dv">-1</span>,j], </a>
<a class="sourceLine" id="cb1-12" data-line-number="12">...... where <span class="st">&quot;+1&quot;</span> is the bonus <span class="cf">for</span> a match; </a>
<a class="sourceLine" id="cb1-13" data-line-number="13">...... <span class="cf">if</span> x[i<span class="dv">-1</span>] <span class="op">!=</span><span class="st"> </span>y[i<span class="dv">-1</span>], then set s[i,j] to the maximum score among S[i,j<span class="dv">-1</span>] and S[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">....<span class="dv">6</span> Record the position of the maximum <span class="kw">score</span> (upper, upper<span class="op">-</span>left, or left)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">..End loop</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">End loop</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="dv">7</span> Perform backtrack</a></code></pre></div>
<p>We’re going to create a function that computes the LCS based on the pseudocode above. It’ll take two sequences, x and y. We’ll call the function find_lcs, and it’ll wrap our code like so:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="co">## code will go here</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb2-5" data-line-number="5">}</a></code></pre></div>
<p>We’ll start with the following two sequences:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">x &lt;-<span class="st"> &#39;AGCAGACACGTGAT&#39;</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">y &lt;-<span class="st"> &#39;ATCACCGGTAT&#39;</span></a></code></pre></div>
<p>Now, the actual algorithm can be written a bunch of ways, but we’re first going to split the sequence strings into character vectors, for example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a></code></pre></div>
<pre><code>##  [1] &quot;A&quot; &quot;G&quot; &quot;C&quot; &quot;A&quot; &quot;G&quot; &quot;A&quot; &quot;C&quot; &quot;A&quot; &quot;C&quot; &quot;G&quot; &quot;T&quot; &quot;G&quot; &quot;A&quot; &quot;T&quot;</code></pre>
<p>so,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a></code></pre></div>
<p>We also will create two variables, m and n, that will store the length of our sequences:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a></code></pre></div>
<p>Lastly, we need to preinitialize our score and backtrack matrices. Recall that each is padded by an additional row and column that is filled in with either zeros or some type of penalty:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a></code></pre></div>
<p>This gives us matrices that look like</p>
<pre><code>##     A T C A C C G G T A T
##   0 0 0 0 0 0 0 0 0 0 0 0
## A 0 0 0 0 0 0 0 0 0 0 0 0
## G 0 0 0 0 0 0 0 0 0 0 0 0
## C 0 0 0 0 0 0 0 0 0 0 0 0
## A 0 0 0 0 0 0 0 0 0 0 0 0
## G 0 0 0 0 0 0 0 0 0 0 0 0
## A 0 0 0 0 0 0 0 0 0 0 0 0
## C 0 0 0 0 0 0 0 0 0 0 0 0
## A 0 0 0 0 0 0 0 0 0 0 0 0
## C 0 0 0 0 0 0 0 0 0 0 0 0
## G 0 0 0 0 0 0 0 0 0 0 0 0
## T 0 0 0 0 0 0 0 0 0 0 0 0
## G 0 0 0 0 0 0 0 0 0 0 0 0
## A 0 0 0 0 0 0 0 0 0 0 0 0
## T 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<pre><code>##      A  T  C  A  C  C  G  G  T  A  T 
##   &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## A &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## G &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## C &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## A &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## G &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## A &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## C &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## A &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## C &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## G &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## T &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## G &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## A &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;
## T &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;</code></pre>
<p>Putting it all together, our function should so far look like:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="co">## more code will go here</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">}</a></code></pre></div>
<p>Now, we have to loop through these matrices just like we would if we were doing this problem on paper. We start at the upper left corner and work our way down to the bottom right. As we move down, we pay close attention to the upper, left, and upper-left diagonal cells relative to our current position. Starting with the loops, our function should look like</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb12-15" data-line-number="15">      <span class="co">## more code will go here</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16">          </a>
<a class="sourceLine" id="cb12-17" data-line-number="17">    }</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">}</a></code></pre></div>
<p>Pay careful attention to the indexes we’re iterating over; this is critical. Position i=2, j=2, means different things with respect to the score and backtracking matrices compared to the actual sequences. This position (2,2), in the matrices, represents letters A and A for the sequences, respectively. But position 2 in either sequence, so x[2] and y[2], would actually index the second letter in either (C and T). Consequently, we can iterate with respect to the matrices’ indexes and adjust when we need to index the sequences or vice versa. Here, we’ll iterate with respect to the matrices and adjust the indexes for x and y, such that s[i,] corresponds to x[i-1] and s[,j] corresponds to y[j-1]:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">i &lt;-<span class="st"> </span><span class="dv">5</span>; j &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">rownames</span>(s)[i] <span class="op">==</span><span class="st"> </span>x[i]</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">rownames</span>(s)[i] <span class="op">==</span><span class="st"> </span>x[i<span class="dv">-1</span>]</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">rownames</span>(s)[j] <span class="op">==</span><span class="st"> </span>x[j]</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">rownames</span>(s)[j] <span class="op">==</span><span class="st"> </span>x[j<span class="dv">-1</span>]</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Next, we’ll add our scoring criteria, which pertains to the left, upper, and upper-left diagonal scores relative to our current position. Thus, if we are at position i, j, then we care about scores s[i-1,j], s[i,j-1], and s[i-1,j-1], respectively. We also want to add our match bonus, in which we’ll add 1 to the score of the upper-left diagonal, assuming there is an actual match in our sequence at this position (which we’ll get to next).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb21-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb21-9" data-line-number="9">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb21-12" data-line-number="12">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb21-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb21-15" data-line-number="15">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb21-16" data-line-number="16">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb21-17" data-line-number="17">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18">      </a>
<a class="sourceLine" id="cb21-19" data-line-number="19">      <span class="co">## more code will go here</span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20">          </a>
<a class="sourceLine" id="cb21-21" data-line-number="21">    }</a>
<a class="sourceLine" id="cb21-22" data-line-number="22">  }</a>
<a class="sourceLine" id="cb21-23" data-line-number="23">}</a></code></pre></div>
<p>Now, we’ll deal with awarding the correct score for our current position. Recall the piecewise function is as follows,</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">....<span class="dv">5</span> <span class="cf">if</span> the current nucleotides <span class="cf">in</span> x and y are the same, such that x[i<span class="dv">-1</span>] <span class="op">==</span><span class="st"> </span>y[i<span class="dv">-1</span>], </a>
<a class="sourceLine" id="cb22-2" data-line-number="2">....  set s[i,j] to the maximum score among S[i,j<span class="dv">-1</span>], S[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, and S[i<span class="dv">-1</span>,j], </a>
<a class="sourceLine" id="cb22-3" data-line-number="3">....  where <span class="st">&quot;+1&quot;</span> is the bonus <span class="cf">for</span> a match; </a>
<a class="sourceLine" id="cb22-4" data-line-number="4">....  <span class="cf">if</span> x[i<span class="dv">-1</span>] <span class="op">!=</span><span class="st"> </span>y[i<span class="dv">-1</span>], then set s[i,j] to the maximum score among S[i,j<span class="dv">-1</span>] and S[i<span class="dv">-1</span>,j]</a></code></pre></div>
<p>Thus, we’ll add the following to our function, which will create a vector that stores our 2 or 3 scores, depending on whether there is a match:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb23-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb23-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb23-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb23-9" data-line-number="9">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb23-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb23-12" data-line-number="12">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb23-13" data-line-number="13">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb23-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb23-15" data-line-number="15">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb23-16" data-line-number="16">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb23-17" data-line-number="17">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb23-18" data-line-number="18">      </a>
<a class="sourceLine" id="cb23-19" data-line-number="19">      <span class="cf">if</span> (x[i<span class="dv">-1</span>]<span class="op">==</span>y[j<span class="dv">-1</span>]) scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left,s_diag) <span class="cf">else</span> scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left)</a>
<a class="sourceLine" id="cb23-20" data-line-number="20">      </a>
<a class="sourceLine" id="cb23-21" data-line-number="21">      score_update &lt;-<span class="st"> </span><span class="kw">max</span>(scores)</a>
<a class="sourceLine" id="cb23-22" data-line-number="22">      </a>
<a class="sourceLine" id="cb23-23" data-line-number="23">      <span class="co">## more code will go here</span></a>
<a class="sourceLine" id="cb23-24" data-line-number="24">          </a>
<a class="sourceLine" id="cb23-25" data-line-number="25">    }</a>
<a class="sourceLine" id="cb23-26" data-line-number="26">  }</a>
<a class="sourceLine" id="cb23-27" data-line-number="27">}</a></code></pre></div>
<p>We also need to know which of the 3 cells contributed to our current position’s score, so we’ll record the index of the max score in our scores vector. We’ll call it backtrack update (which will soon be obvious).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb24-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb24-9" data-line-number="9">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb24-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb24-12" data-line-number="12">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb24-13" data-line-number="13">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb24-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb24-15" data-line-number="15">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb24-16" data-line-number="16">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb24-17" data-line-number="17">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18">      </a>
<a class="sourceLine" id="cb24-19" data-line-number="19">      <span class="cf">if</span> (x[i<span class="dv">-1</span>]<span class="op">==</span>y[j<span class="dv">-1</span>]) scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left,s_diag) <span class="cf">else</span> scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left)</a>
<a class="sourceLine" id="cb24-20" data-line-number="20">      </a>
<a class="sourceLine" id="cb24-21" data-line-number="21">      backtrack_update &lt;-<span class="st"> </span><span class="kw">which.max</span>(scores)</a>
<a class="sourceLine" id="cb24-22" data-line-number="22">      score_update &lt;-<span class="st"> </span><span class="kw">max</span>(scores)</a>
<a class="sourceLine" id="cb24-23" data-line-number="23">      </a>
<a class="sourceLine" id="cb24-24" data-line-number="24">      <span class="co">## more code will go here</span></a>
<a class="sourceLine" id="cb24-25" data-line-number="25">          </a>
<a class="sourceLine" id="cb24-26" data-line-number="26">    }</a>
<a class="sourceLine" id="cb24-27" data-line-number="27">  }</a>
<a class="sourceLine" id="cb24-28" data-line-number="28">}</a></code></pre></div>
<p>Our backtrack_update variable records the position in the scores vector that had the max value, whereas the score_update variable contains the actual max score. We can use the position of the max value as a way of indexing a dictionary that can contain arrows that point to the cell that contributed to the current positions score. We’ll name this dictionary backtrack_key and place it outside of the loop:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb25-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb25-9" data-line-number="9">  backtrack_key &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;|&#39;</span>,<span class="st">&#39;--&#39;</span>,<span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb25-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb25-11" data-line-number="11">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb25-12" data-line-number="12">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb25-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb25-14" data-line-number="14">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb25-15" data-line-number="15">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb25-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb25-17" data-line-number="17">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb25-18" data-line-number="18">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb25-19" data-line-number="19">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb25-20" data-line-number="20">      </a>
<a class="sourceLine" id="cb25-21" data-line-number="21">      <span class="cf">if</span> (x[i<span class="dv">-1</span>]<span class="op">==</span>y[j<span class="dv">-1</span>]) scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left,s_diag) <span class="cf">else</span> scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left)</a>
<a class="sourceLine" id="cb25-22" data-line-number="22">      </a>
<a class="sourceLine" id="cb25-23" data-line-number="23">      backtrack_update &lt;-<span class="st"> </span><span class="kw">which.max</span>(scores)</a>
<a class="sourceLine" id="cb25-24" data-line-number="24">      score_update &lt;-<span class="st"> </span><span class="kw">max</span>(scores)</a>
<a class="sourceLine" id="cb25-25" data-line-number="25">      </a>
<a class="sourceLine" id="cb25-26" data-line-number="26">      <span class="co">## more code will go here</span></a>
<a class="sourceLine" id="cb25-27" data-line-number="27">          </a>
<a class="sourceLine" id="cb25-28" data-line-number="28">    }</a>
<a class="sourceLine" id="cb25-29" data-line-number="29">  }</a>
<a class="sourceLine" id="cb25-30" data-line-number="30">}</a></code></pre></div>
<p>Finally, we can update our s and b matrices:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb26-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb26-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb26-9" data-line-number="9">  backtrack_key &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;|&#39;</span>,<span class="st">&#39;--&#39;</span>,<span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb26-11" data-line-number="11">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb26-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb26-14" data-line-number="14">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb26-15" data-line-number="15">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb26-17" data-line-number="17">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb26-18" data-line-number="18">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb26-19" data-line-number="19">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20">      </a>
<a class="sourceLine" id="cb26-21" data-line-number="21">      <span class="cf">if</span> (x[i<span class="dv">-1</span>]<span class="op">==</span>y[j<span class="dv">-1</span>]) scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left,s_diag) <span class="cf">else</span> scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left)</a>
<a class="sourceLine" id="cb26-22" data-line-number="22">      </a>
<a class="sourceLine" id="cb26-23" data-line-number="23">      backtrack_update &lt;-<span class="st"> </span><span class="kw">which.max</span>(scores)</a>
<a class="sourceLine" id="cb26-24" data-line-number="24">      score_update &lt;-<span class="st"> </span><span class="kw">max</span>(scores)</a>
<a class="sourceLine" id="cb26-25" data-line-number="25">      </a>
<a class="sourceLine" id="cb26-26" data-line-number="26">      s[i,j] &lt;-<span class="st"> </span>score_update</a>
<a class="sourceLine" id="cb26-27" data-line-number="27">      b[i,j] &lt;-<span class="st"> </span>backtrack_key[backtrack_update]</a>
<a class="sourceLine" id="cb26-28" data-line-number="28">          </a>
<a class="sourceLine" id="cb26-29" data-line-number="29">    }</a>
<a class="sourceLine" id="cb26-30" data-line-number="30">  }</a>
<a class="sourceLine" id="cb26-31" data-line-number="31">}</a></code></pre></div>
<p>That’s the function. It will calculate both the path history and the scores for all nucleotides. Now the question is “what about the backtracking”? We’ll deal with that for global alignment, but for now, we’ll use the following recursive function to handle it. We also have to update an option to allow for very deep recursions (if that makes no sense, don’t worry about it). We’ll finish the function up with a list that contains all of the information we’d like returned.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">backtrack_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(b,x,m,n){</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  <span class="cf">if</span> (m<span class="op">==</span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>n<span class="op">==</span><span class="dv">0</span>) <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  <span class="cf">if</span> (b[m<span class="op">+</span><span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>] <span class="op">==</span><span class="st"> &#39;</span><span class="ch">\\</span><span class="st">&#39;</span>){</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">    <span class="kw">return</span>(<span class="kw">c</span>(x[m],<span class="kw">backtrack_lcs</span>(b,x,m<span class="dv">-1</span>,n<span class="dv">-1</span>)))</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">  }<span class="cf">else</span> <span class="cf">if</span>(b[m<span class="op">+</span><span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>] <span class="op">==</span><span class="st"> &#39;|&#39;</span>){</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">    <span class="kw">backtrack_lcs</span>(b,x,m<span class="dv">-1</span>,n)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">    <span class="kw">backtrack_lcs</span>(b,x,m,n<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb27-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb27-11" data-line-number="11"></a>
<a class="sourceLine" id="cb27-12" data-line-number="12">find_lcs &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb27-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb27-14" data-line-number="14">  <span class="kw">options</span>(<span class="dt">expressions=</span><span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb27-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb27-16" data-line-number="16">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb27-17" data-line-number="17">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb27-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb27-19" data-line-number="19">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb27-20" data-line-number="20">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb27-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb27-22" data-line-number="22">  backtrack_key &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;|&#39;</span>,<span class="st">&#39;--&#39;</span>,<span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb27-23" data-line-number="23">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb27-24" data-line-number="24">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb27-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb27-26" data-line-number="26">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb27-27" data-line-number="27">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb27-28" data-line-number="28">      </a>
<a class="sourceLine" id="cb27-29" data-line-number="29">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j]</a>
<a class="sourceLine" id="cb27-30" data-line-number="30">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb27-31" data-line-number="31">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb27-32" data-line-number="32">      </a>
<a class="sourceLine" id="cb27-33" data-line-number="33">      <span class="cf">if</span> (x[i<span class="dv">-1</span>]<span class="op">==</span>y[j<span class="dv">-1</span>]) scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left,s_diag) <span class="cf">else</span> scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left)</a>
<a class="sourceLine" id="cb27-34" data-line-number="34">      </a>
<a class="sourceLine" id="cb27-35" data-line-number="35">      backtrack_update &lt;-<span class="st"> </span><span class="kw">which.max</span>(scores)</a>
<a class="sourceLine" id="cb27-36" data-line-number="36">      score_update &lt;-<span class="st"> </span><span class="kw">max</span>(scores)</a>
<a class="sourceLine" id="cb27-37" data-line-number="37">      </a>
<a class="sourceLine" id="cb27-38" data-line-number="38">      s[i,j] &lt;-<span class="st"> </span>score_update</a>
<a class="sourceLine" id="cb27-39" data-line-number="39">      b[i,j] &lt;-<span class="st"> </span>backtrack_key[backtrack_update]</a>
<a class="sourceLine" id="cb27-40" data-line-number="40">      </a>
<a class="sourceLine" id="cb27-41" data-line-number="41">    }</a>
<a class="sourceLine" id="cb27-42" data-line-number="42">  }</a>
<a class="sourceLine" id="cb27-43" data-line-number="43">  </a>
<a class="sourceLine" id="cb27-44" data-line-number="44">  lcs &lt;-<span class="st"> </span><span class="kw">backtrack_lcs</span>(b,x,m,n)</a>
<a class="sourceLine" id="cb27-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb27-46" data-line-number="46">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">lcs=</span><span class="kw">paste0</span>(<span class="kw">rev</span>(lcs),<span class="dt">collapse=</span><span class="st">&#39;&#39;</span>),</a>
<a class="sourceLine" id="cb27-47" data-line-number="47">              <span class="dt">length=</span>s[<span class="kw">length</span>(s)],</a>
<a class="sourceLine" id="cb27-48" data-line-number="48">              <span class="dt">score=</span>s,</a>
<a class="sourceLine" id="cb27-49" data-line-number="49">              <span class="dt">backtrack=</span>b))</a>
<a class="sourceLine" id="cb27-50" data-line-number="50">  </a>
<a class="sourceLine" id="cb27-51" data-line-number="51">}</a></code></pre></div>
<p>We can now test it out:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">find_lcs</span>(<span class="st">&#39;AGCAGACACGTGAT&#39;</span>,<span class="st">&#39;ATCACCGGTAT&#39;</span>)</a></code></pre></div>
<pre><code>## $lcs
## [1] &quot;ACACCGTAT&quot;
## 
## $length
## [1] 9
## 
## $score
##     A T C A C C G G T A T
##   0 0 0 0 0 0 0 0 0 0 0 0
## A 0 1 1 1 1 1 1 1 1 1 1 1
## G 0 1 1 1 1 1 1 2 2 2 2 2
## C 0 1 1 2 2 2 2 2 2 2 2 2
## A 0 1 1 2 3 3 3 3 3 3 3 3
## G 0 1 1 2 3 3 3 4 4 4 4 4
## A 0 1 1 2 3 3 3 4 4 4 5 5
## C 0 1 1 2 3 4 4 4 4 4 5 5
## A 0 1 1 2 3 4 4 4 4 4 5 5
## C 0 1 1 2 3 4 5 5 5 5 5 5
## G 0 1 1 2 3 4 5 6 6 6 6 6
## T 0 1 2 2 3 4 5 6 6 7 7 7
## G 0 1 2 2 3 4 5 6 7 7 7 7
## A 0 1 2 2 3 4 5 6 7 7 8 8
## T 0 1 2 2 3 4 5 6 7 8 8 9
## 
## $backtrack
##      A    T    C    A    C    C    G    G    T    A    T   
##   &quot;&quot; &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;  
## A &quot;&quot; &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot;
## G &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot;
## C &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot; 
## A &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot;
## G &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot;
## A &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot;
## C &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot; 
## A &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot; 
## C &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;|&quot;  &quot;|&quot; 
## G &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot; &quot;--&quot;
## T &quot;&quot; &quot;|&quot;  &quot;\\&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot; &quot;--&quot;
## G &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot; 
## A &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;--&quot;
## T &quot;&quot; &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;|&quot;  &quot;\\&quot; &quot;|&quot;  &quot;\\&quot;</code></pre>
<p>And now with much longer sequences:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">xy &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_lines</span>(<span class="st">&#39;https://gist.githubusercontent.com/sw1/8870a124624f31585d5c15be72fcfc21/raw/6617b2ceae8765ff7b91f4a600fc5460b335279d/lcs_sequences&#39;</span>)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="kw">find_lcs</span>(xy[<span class="dv">1</span>],xy[<span class="dv">2</span>])<span class="op">$</span>lcs</a></code></pre></div>
<pre><code>## [1] &quot;CTCTAAGCCAATGGCTCAGGGTGGGTGTAGCGATCCCGCGACAGTAAGCGTCTTGGTAGTTTCATCGCAGCTTCGACCTCGGGTTATCCCGCACCACCCCTTAGACTATTAAGAGCGAATACCCAATAAGTCTTTGCTCACATCCCCAGGGTTAAAACCGCGTGAGAGCGTCTCGACACGTTCTCGTTTATAGGGCGTAATTCATTCTGAGTGTGCGCCAGACTCAATACATCGTAGTCTTCTGCAAACGACTATGAGGGATGGACGCTCGGTACTACTGATTAGGTTGACAGTGATACAAACCAGGATGTATATATCGGTAAAGCCAGTTTACCGACTGCATCGCCGAGTGAAGTTCCACTCATGAAGTAAAATCTTAGTATATGTTATGCCCCCCCTTTTTTATCGAAAGTAGACTAGGTCACTTGTTGTACCGAGCCGCGCTGACATATTAACGCACCACCGACCGTTTTAGTCCTGATTGTTGGGGCATATCAGTGAATTGCGTGAGAAGTGGTCAGGTGGAGCCAGCCGAGAATCGGCTCTAGCCTCAAAACCTACTTCCACGTTCTGCCCCACTGCGAGAGAGAACTCCGGAGTCCTTCGTAGGACCAGGGC&quot;</code></pre>
</div>
<div id="global-alignment" class="section level2">
<h2><span class="header-section-number">3.2</span> Global Alignment</h2>
<p>Now we can extend the algorithm above for a global alignment problem. Unlike the LCS problem where we only accounted for insertions and deletions, we’re now going to penalize for mismatches. The score we give based on a particular nucleotide-nucleotide or amino acid-amino acid pair will be defined by a scoring matrix such as the amino acid scoring matrix BLOSSUM62:</p>
<pre><code>##    A  C  D  E  F  G  H  I  K  L  M  N  P  Q  R  S  T  V  W  Y
## A  4  0 -2 -1 -2  0 -2 -1 -1 -1 -1 -2 -1 -1 -1  1  0  0 -3 -2
## C  0  9 -3 -4 -2 -3 -3 -1 -3 -1 -1 -3 -3 -3 -3 -1 -1 -1 -2 -2
## D -2 -3  6  2 -3 -1 -1 -3 -1 -4 -3  1 -1  0 -2  0 -1 -3 -4 -3
## E -1 -4  2  5 -3 -2  0 -3  1 -3 -2  0 -1  2  0  0 -1 -2 -3 -2
## F -2 -2 -3 -3  6 -3 -1  0 -3  0  0 -3 -4 -3 -3 -2 -2 -1  1  3
## G  0 -3 -1 -2 -3  6 -2 -4 -2 -4 -3  0 -2 -2 -2  0 -2 -3 -2 -3
## H -2 -3 -1  0 -1 -2  8 -3 -1 -3 -2  1 -2  0  0 -1 -2 -3 -2  2
## I -1 -1 -3 -3  0 -4 -3  4 -3  2  1 -3 -3 -3 -3 -2 -1  3 -3 -1
## K -1 -3 -1  1 -3 -2 -1 -3  5 -2 -1  0 -1  1  2  0 -1 -2 -3 -2
## L -1 -1 -4 -3  0 -4 -3  2 -2  4  2 -3 -3 -2 -2 -2 -1  1 -2 -1
## M -1 -1 -3 -2  0 -3 -2  1 -1  2  5 -2 -2  0 -1 -1 -1  1 -1 -1
## N -2 -3  1  0 -3  0  1 -3  0 -3 -2  6 -2  0  0  1  0 -3 -4 -2
## P -1 -3 -1 -1 -4 -2 -2 -3 -1 -3 -2 -2  7 -1 -2 -1 -1 -2 -4 -3
## Q -1 -3  0  2 -3 -2  0 -3  1 -2  0  0 -1  5  1  0 -1 -2 -2 -1
## R -1 -3 -2  0 -3 -2  0 -3  2 -2 -1  0 -2  1  5 -1 -1 -3 -3 -2
## S  1 -1  0  0 -2  0 -1 -2  0 -2 -1  1 -1  0 -1  4  1 -2 -3 -2
## T  0 -1 -1 -1 -2 -2 -2 -1 -1 -1 -1  0 -1 -1 -1  1  5  0 -2 -2
## V  0 -1 -3 -2 -1 -3 -3  3 -2  1  1 -3 -2 -2 -3 -2  0  4 -3 -1
## W -3 -2 -4 -3  1 -2 -2 -3 -3 -2 -1 -4 -4 -2 -3 -3 -2 -3 11  2
## Y -2 -2 -3 -2  3 -3  2 -1 -2 -1 -1 -2 -3 -1 -2 -2 -2 -1  2  7</code></pre>
<p>Note that this matrix scores for mismatches <em>and</em> matches, hence we need not develop separate match and mismatch scoring criteria; we can simply use this matrix as a lookup table. Also, unlike before, we’re no longer going to recursively backtrack through our algorithm; instead, we’ll use a while loop to backtrack in a fashion similar to doing the problem on paper. This allows us to take full advantage of the fact we have the longest path recorded in our backtrack matrix and also permits us to shift the position of NTs or AAs in our sequences when necessary by adding ‘-’, allowing us to create our correctly oriented alignment strings.</p>
<p>The algorithm is as follows:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">DEFINE GLOBAL_ALIGNMENT<span class="op">:</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"></a>
<a class="sourceLine" id="cb33-3" data-line-number="3">Given sequences x and y, penalty p, and scoring lookup table score</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="dv">1</span> Create empty an matrix S <span class="cf">for</span> scores and an empty matrix B <span class="cf">for</span> the backtracking path</a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="dv">2</span> Preinitialize edges of S and B based on penalty</a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="dv">3</span> For i <span class="cf">in</span> <span class="dv">2</span> to length x</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">..<span class="dv">4</span> For j <span class="cf">in</span> <span class="dv">2</span> to length y</a>
<a class="sourceLine" id="cb33-9" data-line-number="9">....<span class="dv">5</span> Obtain the score of the upper S[i,j<span class="dv">-1</span>], upper<span class="op">-</span>left diagonal S[i<span class="dv">-1</span>,j<span class="dv">-1</span>], </a>
<a class="sourceLine" id="cb33-10" data-line-number="10">....  and left S[i<span class="dv">-1</span>,j] cells<span class="op">:</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11">...... set s[i,j] to the maximum score among S[i,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>p, S[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>score[x[i<span class="dv">-1</span>],y[j<span class="dv">-1</span>]], </a>
<a class="sourceLine" id="cb33-12" data-line-number="12">...... and S[i<span class="dv">-1</span>,j] <span class="op">+</span><span class="st"> </span>p</a>
<a class="sourceLine" id="cb33-13" data-line-number="13">....<span class="dv">6</span> Record the position of the maximum <span class="kw">score</span> (upper, upper<span class="op">-</span>left, or left).</a>
<a class="sourceLine" id="cb33-14" data-line-number="14">..End loop</a>
<a class="sourceLine" id="cb33-15" data-line-number="15">End loop</a>
<a class="sourceLine" id="cb33-16" data-line-number="16"></a>
<a class="sourceLine" id="cb33-17" data-line-number="17"><span class="dv">7</span> Perform backtrack</a></code></pre></div>
<p>The BLOSSUM62 scoring matrix can be found here:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">blosum62 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">read.table</span>(<span class="st">&#39;https://gist.githubusercontent.com/sw1/8870a124624f31585d5c15be72fcfc21/raw/34c4a34ce49d58b595c3fb2dc77b89a5b6a9b0af/blosum62.dat&#39;</span>))</a></code></pre></div>
<p>And our backtracking algorithm:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">DEFINE GLOBAL_ALIGNMENT_BACKTRACK<span class="op">:</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"></a>
<a class="sourceLine" id="cb35-3" data-line-number="3">Given sequences x and y, backtracking matrix b, penalty p, and scoring lookup table score</a>
<a class="sourceLine" id="cb35-4" data-line-number="4"></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="dv">1</span> Create empty alignment vectors align_x and align_y and </a>
<a class="sourceLine" id="cb35-6" data-line-number="6">. preinitialze score s to <span class="dv">0</span>, m to <span class="kw">len</span>(x), and n to <span class="kw">len</span>(y)</a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="dv">2</span> While m <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> OR n <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8">..<span class="dv">3</span> <span class="cf">if</span> b[m<span class="op">+</span><span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>] <span class="op">==</span><span class="st"> </span>UP</a>
<a class="sourceLine" id="cb35-9" data-line-number="9">.... update align_x</a>
<a class="sourceLine" id="cb35-10" data-line-number="10">.... update align_y</a>
<a class="sourceLine" id="cb35-11" data-line-number="11">.... update score</a>
<a class="sourceLine" id="cb35-12" data-line-number="12">.... m <span class="op">-</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb35-13" data-line-number="13">..<span class="dv">4</span> <span class="cf">if</span> b[m<span class="op">+</span><span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>] <span class="op">==</span><span class="st"> </span>LEFT</a>
<a class="sourceLine" id="cb35-14" data-line-number="14">.... update align_x</a>
<a class="sourceLine" id="cb35-15" data-line-number="15">.... update align_y</a>
<a class="sourceLine" id="cb35-16" data-line-number="16">.... update score</a>
<a class="sourceLine" id="cb35-17" data-line-number="17">.... n <span class="op">-</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb35-18" data-line-number="18">..<span class="dv">5</span> <span class="cf">else</span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19">.... update align_x</a>
<a class="sourceLine" id="cb35-20" data-line-number="20">.... update align_y</a>
<a class="sourceLine" id="cb35-21" data-line-number="21">.... update score</a>
<a class="sourceLine" id="cb35-22" data-line-number="22">.... n <span class="op">-</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb35-23" data-line-number="23">.... m <span class="op">-</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb35-24" data-line-number="24">..End loop</a>
<a class="sourceLine" id="cb35-25" data-line-number="25">End loop</a></code></pre></div>
<p>A sample sequence pair can be found here:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">xy &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_lines</span>(<span class="st">&#39;https://gist.githubusercontent.com/sw1/8870a124624f31585d5c15be72fcfc21/raw/0488087071c0b27cd7a576913d5502bdf95db6e5/global_sequences&#39;</span>)</a></code></pre></div>
</div>
<div id="local-alignment" class="section level2">
<h2><span class="header-section-number">3.3</span> Local Alignment</h2>
<p>Often the alignment between two subsequences between our sequences x and y is better than their global alignment. Performing a local alignment is not much different than the algorithms above except for an important change to the recurrence (piecewise function) that dictates the score for a given position. In the global alignment recurrence, we only factor in scores from the upper-left, left, and upper cells. Now, for a local alignment, we will also factor in the sink (cell position 1,1). Thus, the pseudocode will change to:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">DEFINE LOCAL_ALIGNMENT<span class="op">:</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span>...</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"></a>
<a class="sourceLine" id="cb37-5" data-line-number="5">....<span class="dv">5</span> Obtain the score of the upper S[i,j<span class="dv">-1</span>], upper<span class="op">-</span>left diagonal S[i<span class="dv">-1</span>,j<span class="dv">-1</span>], </a>
<a class="sourceLine" id="cb37-6" data-line-number="6">....  and left S[i<span class="dv">-1</span>,j] cells<span class="op">:</span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7">...... set s[i,j] to the maximum score among S[i,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>p, S[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>score[x[i<span class="dv">-1</span>],y[j<span class="dv">-1</span>]], </a>
<a class="sourceLine" id="cb37-8" data-line-number="8">...... S[i<span class="dv">-1</span>,j] <span class="op">+</span><span class="st"> </span>p, and <span class="fl">0.</span></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"></a>
<a class="sourceLine" id="cb37-10" data-line-number="10">  ...</a></code></pre></div>
<p>The backtrack algorithm will also change such that if we land on a zero, we set m and n to 0 to end the backtrack. Lastly, be sure to record the position of the max score in the matrix, which should act as a starting point during backtracking.</p>
</div>
<div id="local-alignment-homework" class="section level2">
<h2><span class="header-section-number">3.4</span> Local Alignment: Homework</h2>
<p><strong>Edit the global alignment code with the information above to create a function that calculates the local alignment between strings x and y.</strong> Use a penalty of -5 and a PAM250 scoring matrix:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">pam250 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">read.table</span>(<span class="st">&#39;https://gist.githubusercontent.com/sw1/8870a124624f31585d5c15be72fcfc21/raw/0b783786e3797d1bb55172e750776e26021224b0/PAM250.dat&#39;</span>))</a></code></pre></div>
<p>See below for the global alignment code. Fit your algorithm to these sequences:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">xy &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_lines</span>(<span class="st">&#39;https://gist.githubusercontent.com/sw1/8870a124624f31585d5c15be72fcfc21/raw/6617b2ceae8765ff7b91f4a600fc5460b335279d/local_sequences&#39;</span>)</a></code></pre></div>
<p>Report the following:</p>
<ol style="list-style-type: decimal">
<li>The alignment in its own text file (.txt, .dat, etc.)</li>
<li>The max score</li>
<li>Your code (in a text file – specifically, not a .doc or .docx)</li>
</ol>
<p>It’s worth commenting your code to help indicate what you were thinking. Note that a correct forward pass will result in the correct max score; a correct forward <em>and</em> backward pass is required for the correct alignment.</p>
<p>A few hints:</p>
<ol style="list-style-type: decimal">
<li>You’ll need to update (1) the piecewise function and (2) the score vector.</li>
<li>You no longer want to start your backtrack at the bottom right corner (the sink), so update accordingly.</li>
<li>The backtrack will require another if statement.</li>
<li>The backtrack may require some debugging to ensure that your indexes are correct.</li>
</ol>
<p>Also, the code may take as little as 35 seconds to run (and even faster on Python) for the sequences given above. That cmdfun command wrapping the function will speed up your function; it is <strong>not</strong> necessary. If you’re approaching 5 minutes, something is likely wrong. The correct score is around 3000.</p>
</div>
<div id="global-alignment-code-r" class="section level2">
<h2><span class="header-section-number">3.5</span> Global Alignment Code (R)</h2>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">backtrack_global &lt;-<span class="st"> </span><span class="cf">function</span>(x,y,b,score_matrix,penalty){</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb40-3" data-line-number="3">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb40-6" data-line-number="6">  score &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb40-7" data-line-number="7">  align_x &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8">  align_y &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb40-10" data-line-number="10">  <span class="cf">while</span> (m <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>n <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">    <span class="cf">if</span> (b[m<span class="op">+</span><span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>] <span class="op">==</span><span class="st"> &#39;|&#39;</span>){</a>
<a class="sourceLine" id="cb40-12" data-line-number="12">      align_x &lt;-<span class="st"> </span><span class="kw">c</span>(align_x,x[m])</a>
<a class="sourceLine" id="cb40-13" data-line-number="13">      align_y &lt;-<span class="st"> </span><span class="kw">c</span>(align_y,<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb40-14" data-line-number="14">      score &lt;-<span class="st"> </span>score <span class="op">+</span><span class="st"> </span>penalty</a>
<a class="sourceLine" id="cb40-15" data-line-number="15">      m &lt;-<span class="st"> </span>m<span class="dv">-1</span></a>
<a class="sourceLine" id="cb40-16" data-line-number="16">    }<span class="cf">else</span> <span class="cf">if</span>(b[m<span class="op">+</span><span class="dv">1</span>,n<span class="op">+</span><span class="dv">1</span>] <span class="op">==</span><span class="st"> &#39;--&#39;</span>){</a>
<a class="sourceLine" id="cb40-17" data-line-number="17">      align_x &lt;-<span class="st"> </span><span class="kw">c</span>(align_x,<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb40-18" data-line-number="18">      align_y &lt;-<span class="st"> </span><span class="kw">c</span>(align_y,y[n])</a>
<a class="sourceLine" id="cb40-19" data-line-number="19">      score &lt;-<span class="st"> </span>score <span class="op">+</span><span class="st"> </span>penalty</a>
<a class="sourceLine" id="cb40-20" data-line-number="20">      n &lt;-<span class="st"> </span>n<span class="dv">-1</span></a>
<a class="sourceLine" id="cb40-21" data-line-number="21">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb40-22" data-line-number="22">      align_x &lt;-<span class="st"> </span><span class="kw">c</span>(align_x,x[m]) </a>
<a class="sourceLine" id="cb40-23" data-line-number="23">      align_y &lt;-<span class="st"> </span><span class="kw">c</span>(align_y,y[n])</a>
<a class="sourceLine" id="cb40-24" data-line-number="24">      score &lt;-<span class="st"> </span>score <span class="op">+</span><span class="st"> </span>score_matrix[x[m],y[n]]</a>
<a class="sourceLine" id="cb40-25" data-line-number="25">      n &lt;-<span class="st"> </span>n<span class="dv">-1</span></a>
<a class="sourceLine" id="cb40-26" data-line-number="26">      m &lt;-<span class="st"> </span>m<span class="dv">-1</span></a>
<a class="sourceLine" id="cb40-27" data-line-number="27">    }</a>
<a class="sourceLine" id="cb40-28" data-line-number="28">  }</a>
<a class="sourceLine" id="cb40-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb40-30" data-line-number="30">  alignment &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="kw">rev</span>(align_x),<span class="dt">collapse=</span><span class="st">&#39;&#39;</span>),<span class="kw">paste0</span>(<span class="kw">rev</span>(align_y),<span class="dt">collapse=</span><span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb40-31" data-line-number="31">  </a>
<a class="sourceLine" id="cb40-32" data-line-number="32">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">score=</span>score,<span class="dt">alignment=</span>alignment))</a>
<a class="sourceLine" id="cb40-33" data-line-number="33">  </a>
<a class="sourceLine" id="cb40-34" data-line-number="34">}</a>
<a class="sourceLine" id="cb40-35" data-line-number="35"></a>
<a class="sourceLine" id="cb40-36" data-line-number="36"><span class="kw">library</span>(compiler)</a>
<a class="sourceLine" id="cb40-37" data-line-number="37">global_alignment &lt;-<span class="st"> </span><span class="kw">cmpfun</span>(<span class="cf">function</span>(x,y,score_matrix,penalty){</a>
<a class="sourceLine" id="cb40-38" data-line-number="38">  </a>
<a class="sourceLine" id="cb40-39" data-line-number="39">  x &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb40-40" data-line-number="40">  y &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(y,<span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb40-41" data-line-number="41">  </a>
<a class="sourceLine" id="cb40-42" data-line-number="42">  m &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb40-43" data-line-number="43">  n &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb40-44" data-line-number="44">  </a>
<a class="sourceLine" id="cb40-45" data-line-number="45">  backtrack_key &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;|&#39;</span>,<span class="st">&#39;--&#39;</span>,<span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb40-46" data-line-number="46">  </a>
<a class="sourceLine" id="cb40-47" data-line-number="47">  s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb40-48" data-line-number="48">  s[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">rep</span>(penalty,<span class="kw">ncol</span>(s)<span class="op">-</span><span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb40-49" data-line-number="49">  s[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">rep</span>(penalty,<span class="kw">nrow</span>(s)<span class="op">-</span><span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb40-50" data-line-number="50">  </a>
<a class="sourceLine" id="cb40-51" data-line-number="51">  b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&#39;&#39;</span>,<span class="kw">length</span>(x)<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(y)<span class="op">+</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,x),<span class="kw">c</span>(<span class="st">&#39;&#39;</span>,y)))</a>
<a class="sourceLine" id="cb40-52" data-line-number="52">  b[<span class="dv">1</span>,] &lt;-<span class="st"> &#39;--&#39;</span></a>
<a class="sourceLine" id="cb40-53" data-line-number="53">  b[,<span class="dv">1</span>] &lt;-<span class="st"> &#39;|&#39;</span></a>
<a class="sourceLine" id="cb40-54" data-line-number="54">  b[<span class="dv">1</span>,<span class="dv">1</span>] &lt;-<span class="st"> &#39;</span><span class="ch">\\</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb40-55" data-line-number="55">  </a>
<a class="sourceLine" id="cb40-56" data-line-number="56">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,m<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb40-57" data-line-number="57">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,n<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb40-58" data-line-number="58">      </a>
<a class="sourceLine" id="cb40-59" data-line-number="59">      s_up &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j] <span class="op">+</span><span class="st"> </span>penalty</a>
<a class="sourceLine" id="cb40-60" data-line-number="60">      s_left &lt;-<span class="st"> </span>s[i,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>penalty</a>
<a class="sourceLine" id="cb40-61" data-line-number="61">      s_diag &lt;-<span class="st"> </span>s[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>score_matrix[x[i<span class="dv">-1</span>],y[j<span class="dv">-1</span>]]</a>
<a class="sourceLine" id="cb40-62" data-line-number="62">      </a>
<a class="sourceLine" id="cb40-63" data-line-number="63">      scores &lt;-<span class="st"> </span><span class="kw">c</span>(s_up,s_left,s_diag) </a>
<a class="sourceLine" id="cb40-64" data-line-number="64">      </a>
<a class="sourceLine" id="cb40-65" data-line-number="65">      backtrack_update &lt;-<span class="st"> </span><span class="kw">which.max</span>(scores)</a>
<a class="sourceLine" id="cb40-66" data-line-number="66">      score_matrix_update &lt;-<span class="st"> </span><span class="kw">max</span>(scores)</a>
<a class="sourceLine" id="cb40-67" data-line-number="67">      </a>
<a class="sourceLine" id="cb40-68" data-line-number="68">      s[i,j] &lt;-<span class="st"> </span>score_matrix_update</a>
<a class="sourceLine" id="cb40-69" data-line-number="69">      b[i,j] &lt;-<span class="st"> </span>backtrack_key[backtrack_update]</a>
<a class="sourceLine" id="cb40-70" data-line-number="70">      </a>
<a class="sourceLine" id="cb40-71" data-line-number="71">    }</a>
<a class="sourceLine" id="cb40-72" data-line-number="72">  }</a>
<a class="sourceLine" id="cb40-73" data-line-number="73">  </a>
<a class="sourceLine" id="cb40-74" data-line-number="74">  <span class="kw">return</span>(<span class="kw">backtrack_global</span>(x,y,b,score_matrix,penalty))</a>
<a class="sourceLine" id="cb40-75" data-line-number="75">  </a>
<a class="sourceLine" id="cb40-76" data-line-number="76">})</a></code></pre></div>
</div>
<div id="global-alignment-code-python" class="section level2">
<h2><span class="header-section-number">3.6</span> Global Alignment Code (Python)</h2>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="im">import</span> urllib.request</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="kw">def</span> scoring_matrix(filename):</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">    scoring <span class="op">=</span> urllib.request.urlopen(filename).readlines()</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">    scoring <span class="op">=</span> [i.decode(<span class="st">&quot;utf-8&quot;</span>).strip(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)  <span class="cf">for</span> i <span class="kw">in</span> scoring[<span class="dv">1</span>:]]</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">    keys <span class="op">=</span> [i[<span class="dv">0</span>] <span class="cf">for</span> i <span class="kw">in</span> scoring]</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">    scoring <span class="op">=</span> [i.split()[<span class="dv">1</span>:] <span class="cf">for</span> i <span class="kw">in</span> scoring]</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">    scoring_dict <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb41-9" data-line-number="9">    <span class="cf">for</span> ii,i <span class="kw">in</span> <span class="bu">enumerate</span>(keys):</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">        scoring_dict[i] <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb41-11" data-line-number="11">        <span class="cf">for</span> ji,j <span class="kw">in</span> <span class="bu">enumerate</span>(keys):</a>
<a class="sourceLine" id="cb41-12" data-line-number="12">            scoring_dict[i][j] <span class="op">=</span> <span class="bu">int</span>(scoring[ii][ji])</a>
<a class="sourceLine" id="cb41-13" data-line-number="13">    <span class="cf">return</span> scoring_dict</a>
<a class="sourceLine" id="cb41-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb41-15" data-line-number="15"><span class="kw">def</span> global_alignment(v,w,penalty,matrix_file):</a>
<a class="sourceLine" id="cb41-16" data-line-number="16">    score_matrix <span class="op">=</span> scoring_matrix(matrix_file)</a>
<a class="sourceLine" id="cb41-17" data-line-number="17">    s <span class="op">=</span> [[<span class="dv">0</span>]<span class="op">*</span>(<span class="bu">len</span>(w)<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(v)<span class="op">+</span><span class="dv">1</span>)]</a>
<a class="sourceLine" id="cb41-18" data-line-number="18">    s[<span class="dv">0</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>,penalty<span class="op">*</span><span class="bu">len</span>(s[<span class="dv">0</span>]),penalty))</a>
<a class="sourceLine" id="cb41-19" data-line-number="19">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(s)):</a>
<a class="sourceLine" id="cb41-20" data-line-number="20">        s[i][<span class="dv">0</span>] <span class="op">=</span> penalty <span class="op">+</span> s[i<span class="dv">-1</span>][<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb41-21" data-line-number="21">    path <span class="op">=</span> [[<span class="st">&#39;||&#39;</span>] <span class="op">+</span> [<span class="st">&#39;--&#39;</span>]<span class="op">*</span>(<span class="bu">len</span>(w)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(v)<span class="op">+</span><span class="dv">1</span>)]</a>
<a class="sourceLine" id="cb41-22" data-line-number="22">    path[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb41-23" data-line-number="23">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(v)<span class="op">+</span><span class="dv">1</span>):</a>
<a class="sourceLine" id="cb41-24" data-line-number="24">        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(w)<span class="op">+</span><span class="dv">1</span>):</a>
<a class="sourceLine" id="cb41-25" data-line-number="25">            score <span class="op">=</span> score_matrix[v[i<span class="dv">-1</span>]][w[j<span class="dv">-1</span>]]</a>
<a class="sourceLine" id="cb41-26" data-line-number="26">            s[i][j] <span class="op">=</span> <span class="bu">max</span>(s[i<span class="dv">-1</span>][j<span class="dv">-1</span>] <span class="op">+</span> score, s[i][j<span class="dv">-1</span>] <span class="op">+</span> penalty,s[i<span class="dv">-1</span>][j] <span class="op">+</span> penalty)</a>
<a class="sourceLine" id="cb41-27" data-line-number="27">            <span class="cf">if</span> s[i][j] <span class="op">==</span> s[i<span class="dv">-1</span>][j] <span class="op">+</span> penalty:</a>
<a class="sourceLine" id="cb41-28" data-line-number="28">                path[i][j] <span class="op">=</span> <span class="st">&#39;||&#39;</span></a>
<a class="sourceLine" id="cb41-29" data-line-number="29">            <span class="cf">if</span> s[i][j] <span class="op">==</span> s[i][j<span class="dv">-1</span>] <span class="op">+</span> penalty:</a>
<a class="sourceLine" id="cb41-30" data-line-number="30">                path[i][j] <span class="op">=</span> <span class="st">&quot;--&quot;</span></a>
<a class="sourceLine" id="cb41-31" data-line-number="31">            <span class="cf">if</span> s[i][j] <span class="op">==</span> s[i<span class="dv">-1</span>][j<span class="dv">-1</span>] <span class="op">+</span> score:</a>
<a class="sourceLine" id="cb41-32" data-line-number="32">                path[i][j] <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb41-33" data-line-number="33">    score <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb41-34" data-line-number="34">    align1 <span class="op">=</span> <span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb41-35" data-line-number="35">    align2 <span class="op">=</span> <span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb41-36" data-line-number="36">    <span class="cf">while</span> i <span class="op">&gt;=</span> <span class="dv">1</span> <span class="kw">or</span> j <span class="op">&gt;=</span> <span class="dv">1</span>:</a>
<a class="sourceLine" id="cb41-37" data-line-number="37">        <span class="cf">if</span> path[i][j] <span class="op">==</span> <span class="st">&quot;||&quot;</span>:</a>
<a class="sourceLine" id="cb41-38" data-line-number="38">            align1 <span class="op">+=</span> v[i<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb41-39" data-line-number="39">            align2 <span class="op">+=</span> <span class="st">&#39;-&#39;</span></a>
<a class="sourceLine" id="cb41-40" data-line-number="40">            score <span class="op">+=</span> penalty</a>
<a class="sourceLine" id="cb41-41" data-line-number="41">            i <span class="op">-=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb41-42" data-line-number="42">        <span class="cf">elif</span> path[i][j] <span class="op">==</span> <span class="st">&quot;--&quot;</span>:</a>
<a class="sourceLine" id="cb41-43" data-line-number="43">            align1 <span class="op">+=</span> <span class="st">&#39;-&#39;</span></a>
<a class="sourceLine" id="cb41-44" data-line-number="44">            align2 <span class="op">+=</span> w[j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb41-45" data-line-number="45">            score <span class="op">+=</span> penalty</a>
<a class="sourceLine" id="cb41-46" data-line-number="46">            j <span class="op">-=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb41-47" data-line-number="47">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb41-48" data-line-number="48">            align1 <span class="op">+=</span> v[i<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb41-49" data-line-number="49">            align2 <span class="op">+=</span> w[j<span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb41-50" data-line-number="50">            score <span class="op">+=</span> score_matrix[w[j<span class="dv">-1</span>]][v[i<span class="dv">-1</span>]]</a>
<a class="sourceLine" id="cb41-51" data-line-number="51">            i <span class="op">-=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb41-52" data-line-number="52">            j <span class="op">-=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb41-53" data-line-number="53">    align1 <span class="op">=</span> align1[::<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb41-54" data-line-number="54">    align2 <span class="op">=</span> align2[::<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb41-55" data-line-number="55">    <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join([<span class="bu">str</span>(score),align1,align2]))</a>
<a class="sourceLine" id="cb41-56" data-line-number="56">    <span class="cf">return</span> [score, align1,align2]</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dynprog.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="align-alg.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bioinformatics_class.pdf", "bioinformatics_class.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
